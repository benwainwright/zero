import{a as w,p as s,w as me,y as he}from"./chunk-7TW6LJC6-DaDHYynL.js";import{l as N,B as I,h as $,i as z,m as E,v as K,n as R,w as be}from"./current-user-provider-CQskWHqO.js";import{u as xe}from"./use-data-Qeg4wdiC.js";import{u as fe}from"./use-roles-vQCtzGaX.js";import{I as G,c as Ce,a as ve,b as ke,u as ye,T as H}from"./use-form-CHjNTqrC.js";import{P as ge}from"./page-9TQxibTZ.js";import{P as J,B as Pe}from"./PasswordInput-BVpFYo-r.js";import{C as M,F as _e,S as je}from"./Stack-DWOd-5q9.js";import{b as F,c as Ie,g as T}from"./use-isomorphic-effect-BxLUwthI.js";import{a as Q}from"./get-contrast-color-Cz5QmDl0.js";import{U as we}from"./UnstyledButton-AqrG-hBD.js";import{u as X,G as Se}from"./Group-CX22UYal.js";import"./use-command-DCyiuDTW.js";import"./use-events-BzQNw1ET.js";import"./CloseButton-BtMh9jHH.js";import"./route-available-D-XKoVLa.js";import"./Loader-DjTkaKnY.js";import"./index-DZSsE0QN.js";import"./use-reduced-motion-COKNnHEg.js";function Y(e,r){return typeof e=="boolean"?e:r.autoContrast}var Z={root:"m_5f75b09e",body:"m_5f6e695e",labelWrapper:"m_d3ea56bb",label:"m_8ee546b8",description:"m_328f68c0",error:"m_8e8a99cc"};const Ue=Z,ee=w.forwardRef(({__staticSelector:e,__stylesApiProps:r,className:t,classNames:i,styles:d,unstyled:n,children:o,label:l,description:a,id:m,disabled:c,error:u,size:b,labelPosition:P="left",bodyElement:f="div",labelElement:h="label",variant:C,style:k,vars:_,mod:v,attributes:y,...p},j)=>{const x=N({name:e,props:r,className:t,style:k,classes:Z,classNames:i,styles:d,unstyled:n,attributes:y});return s.jsx(I,{...x("root"),ref:j,__vars:{"--label-fz":Ie(b),"--label-lh":F(b,"label-lh")},mod:[{"label-position":P},v],variant:C,size:b,...p,children:s.jsxs(I,{component:f,htmlFor:f==="label"?m:void 0,...x("body"),children:[o,s.jsxs("div",{...x("labelWrapper"),"data-disabled":c||void 0,children:[l&&s.jsx(I,{component:h,htmlFor:h==="label"?m:void 0,...x("label"),"data-disabled":c||void 0,children:l}),a&&s.jsx(G.Description,{size:b,__inheritStyles:!1,...x("description"),children:a}),u&&typeof u!="boolean"&&s.jsx(G.Error,{size:b,__inheritStyles:!1,...x("error"),children:u})]})]})})});ee.displayName="@mantine/core/InlineInput";const oe=w.createContext(null),Ve=oe.Provider,se=()=>w.useContext(oe),[Re,Ge]=Ce();var re={card:"m_26775b0a"};const Ne={withBorder:!0},$e=E((e,{radius:r})=>({card:{"--card-radius":T(r)}})),D=$((e,r)=>{const t=z("CheckboxCard",Ne,e),{classNames:i,className:d,style:n,styles:o,unstyled:l,vars:a,checked:m,mod:c,withBorder:u,value:b,onClick:P,defaultChecked:f,onChange:h,attributes:C,...k}=t,_=N({name:"CheckboxCard",classes:re,props:t,className:d,style:n,classNames:i,styles:o,unstyled:l,attributes:C,vars:a,varsResolver:$e,rootSelector:"card"}),v=se(),y=typeof m=="boolean"?m:v?v.value.includes(b||""):void 0,[p,j]=X({value:y,defaultValue:f,finalValue:!1,onChange:h});return s.jsx(Re,{value:{checked:p},children:s.jsx(we,{ref:r,mod:[{"with-border":u,checked:p},c],..._("card"),...k,role:"checkbox","aria-checked":p,onClick:x=>{P?.(x),v?.onChange(b||""),j(!p)}})})});D.displayName="@mantine/core/CheckboxCard";D.classes=re;function ze({children:e,role:r}){const t=ve();return t?s.jsx("div",{role:r,"aria-labelledby":t.labelId,"aria-describedby":t.describedBy,children:e}):s.jsx(s.Fragment,{children:e})}const W=$((e,r)=>{const{value:t,defaultValue:i,onChange:d,size:n,wrapperProps:o,children:l,readOnly:a,disabled:m,...c}=z("CheckboxGroup",null,e),[u,b]=X({value:t,defaultValue:i,finalValue:[],onChange:d}),P=f=>{const h=typeof f=="string"?f:f.currentTarget.value;!a&&b(u.includes(h)?u.filter(C=>C!==h):[...u,h])};return s.jsx(Ve,{value:{value:u,onChange:P,size:n,disabled:m},children:s.jsx(G.Wrapper,{size:n,ref:r,...o,...c,labelElement:"div",__staticSelector:"CheckboxGroup",children:s.jsx(ze,{role:"group",children:l})})})});W.classes=G.Wrapper.classes;W.displayName="@mantine/core/CheckboxGroup";var te={indicator:"m_5e5256ee",icon:"m_1b1c543a","indicator--outline":"m_76e20374"};const Be={icon:M,variant:"filled"},Ee=E((e,{radius:r,color:t,size:i,iconColor:d,variant:n,autoContrast:o})=>{const l=K({color:t||e.primaryColor,theme:e}),a=l.isThemeColor&&l.shade===void 0?`var(--mantine-color-${l.color}-outline)`:l.color;return{indicator:{"--checkbox-size":F(i,"checkbox-size"),"--checkbox-radius":r===void 0?void 0:T(r),"--checkbox-color":n==="outline"?a:R(t,e),"--checkbox-icon-color":d?R(d,e):Y(o,e)?Q({color:t,theme:e,autoContrast:o}):void 0}}}),A=$((e,r)=>{const t=z("CheckboxIndicator",Be,e),{classNames:i,className:d,style:n,styles:o,unstyled:l,vars:a,icon:m,indeterminate:c,radius:u,color:b,iconColor:P,autoContrast:f,checked:h,mod:C,variant:k,disabled:_,attributes:v,...y}=t,p=N({name:"CheckboxIndicator",classes:te,props:t,className:d,style:n,classNames:i,styles:o,unstyled:l,attributes:v,vars:a,varsResolver:Ee,rootSelector:"indicator"}),j=Ge(),x=typeof h=="boolean"||typeof c=="boolean"?h||c:j?.checked||!1;return s.jsx(I,{ref:r,...p("indicator",{variant:k}),variant:k,mod:[{checked:x,disabled:_},C],...y,children:s.jsx(m,{indeterminate:c,...p("icon")})})});A.displayName="@mantine/core/CheckboxIndicator";A.classes=te;var ae={root:"m_bf2d988c",inner:"m_26062bec",input:"m_26063560",icon:"m_bf295423","input--outline":"m_215c4542"};const Fe={labelPosition:"right",icon:M,variant:"filled"},Te=E((e,{radius:r,color:t,size:i,iconColor:d,variant:n,autoContrast:o})=>{const l=K({color:t||e.primaryColor,theme:e}),a=l.isThemeColor&&l.shade===void 0?`var(--mantine-color-${l.color}-outline)`:l.color;return{root:{"--checkbox-size":F(i,"checkbox-size"),"--checkbox-radius":r===void 0?void 0:T(r),"--checkbox-color":n==="outline"?a:R(t,e),"--checkbox-icon-color":d?R(d,e):Y(o,e)?Q({color:t,theme:e,autoContrast:o}):void 0}}}),S=$((e,r)=>{const t=z("Checkbox",Fe,e),{classNames:i,className:d,style:n,styles:o,unstyled:l,vars:a,color:m,label:c,id:u,size:b,radius:P,wrapperProps:f,checked:h,labelPosition:C,description:k,error:_,disabled:v,variant:y,indeterminate:p,icon:j,rootRef:x,iconColor:Ae,onChange:le,autoContrast:Oe,mod:ne,attributes:ce,...ie}=t,U=se(),de=b||U?.size,V=N({name:"Checkbox",props:t,classes:ae,className:d,style:n,classNames:i,styles:o,unstyled:l,attributes:ce,vars:a,varsResolver:Te}),{styleProps:ue,rest:O}=be(ie),q=ke(u),B={checked:U?.value.includes(O.value)??h,onChange:L=>{U?.onChange(L),le?.(L)},disabled:U?.disabled??v},pe=w.useRef(null),g=r||pe;return w.useEffect(()=>{g&&"current"in g&&g.current&&(g.current.indeterminate=p||!1,p?g.current.setAttribute("data-indeterminate","true"):g.current.removeAttribute("data-indeterminate"))},[p,g]),s.jsx(ee,{...V("root"),__staticSelector:"Checkbox",__stylesApiProps:t,id:q,size:de,labelPosition:C,label:c,description:k,error:_,disabled:B.disabled,classNames:i,styles:o,unstyled:l,"data-checked":B.checked||h||void 0,variant:y,ref:x,mod:ne,...ue,...f,children:s.jsxs(I,{...V("inner"),mod:{"data-label-position":C},children:[s.jsx(I,{component:"input",id:q,ref:g,mod:{error:!!_,indeterminate:p},...V("input",{focusable:!0,variant:y}),...O,...B,type:"checkbox"}),s.jsx(j,{indeterminate:p,...V("icon")})]})})});S.classes={...ae,...Ue};S.displayName="@mantine/core/Checkbox";S.Group=W;S.Indicator=A;S.Card=D;const De=e=>{const{data:r,isPending:t,update:i,save:d}=xe({query:"GetUser",command:"UpdateUserCommand",mapToLocalData:n=>{if(n)return{username:n.id,email:n.email,roles:n.roles.map(o=>o.id),password:""}},refreshOn:["UserUpdated"]},{username:e});return{isPending:t,user:r,updateUser:i,saveUser:d}},We=()=>{const{userId:e}=he();if(!e)throw new Error("User id missing!");const{user:r,saveUser:t,isPending:i,updateUser:d}=De(e),n=fe(0,30),o=ye({initialValues:{email:r?.email??"",password:"",roles:r?.roles,validatePassword:""},onValuesChange:a=>{d({username:e,...a})},validate:{email:a=>/^\S+@\S+$/.test(a)?null:"Invalid email",validatePassword:(a,m)=>a!==m.password?"Passwords did not match":null}});w.useEffect(()=>{!i&&r&&(o.setValues({email:r.email,roles:r.roles}),o.resetDirty())},[i]);const l=async()=>{await t()};return s.jsx(ge,{routeName:"editUser",title:"Edit User",children:s.jsxs("form",{method:"post",onSubmit:o.onSubmit(l),children:[s.jsx(H,{label:"Username",placeholder:"",value:e,disabled:!0},o.key("username")),s.jsx(H,{label:"Email",type:"email",placeholder:"",...o.getInputProps("email")},o.key("email")),s.jsx(J,{label:"Password",placeholder:"",...o.getInputProps("password")},o.key("password")),s.jsx(J,{label:"Verify Password",placeholder:"",...o.getInputProps("validatePassword")},o.key("validatePassword")),s.jsx(_e,{legend:"Roles",mt:"lg",children:s.jsx(je,{children:n&&n?.map(a=>(console.log(o.getValues()),s.jsx(S,{checked:o.getValues()?.roles?.includes(a.id)??!1,onChange:m=>{o.setValues(c=>c.roles?m.target.checked?{...c,roles:c.roles.includes(a.id)?c.roles:[...c.roles,a.id]}:{...c,roles:c.roles.filter(u=>u!==a.id)}:c)},label:a.name},`role-checkbox-${a.id}`)))})}),s.jsx(Se,{justify:"flex-end",mt:"md",children:s.jsx(Pe,{type:"submit",disabled:!o.isDirty(),children:"Update"})})]})})},io=me(We);export{io as default};
