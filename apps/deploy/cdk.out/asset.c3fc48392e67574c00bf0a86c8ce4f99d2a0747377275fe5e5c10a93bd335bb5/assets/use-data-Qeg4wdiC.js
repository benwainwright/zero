import{a as t}from"./chunk-7TW6LJC6-DaDHYynL.js";import{t as x}from"./current-user-provider-CQskWHqO.js";import{u as E}from"./use-command-DCyiuDTW.js";import{u as h}from"./use-events-BzQNw1ET.js";const l=(i,...o)=>{const[u,e]=t.useTransition(),[p,c]=t.useState(),[s,r]=t.useState(!0),{api:a}=t.useContext(x);return t.useEffect(()=>{e(async()=>{(async()=>a&&s&&(c(await a.executeQuery(i,...o)),r(!1)))()})},[a,s]),{isPending:u,data:p,refresh:()=>{r(!0)}}},D=({query:i,command:o,refreshOn:u,mapToLocalData:e},...p)=>{const{execute:c}=E(o),{data:s,refresh:r,isPending:a}=l(i,...p),[n,f]=t.useState();t.useEffect(()=>{f(e?{mapped:e(s)}:{unmapped:s})},[s]),h(d=>{u?.includes(d.key)&&r()});const m=d=>{if(!e)throw new Error("Need to supply a mapping function");f({mapped:d})},y=async()=>{if(!e)throw new Error("Need to supply a mapping function");n&&n.mapped&&await c(n.mapped)},w=e?n?.mapped:n?.unmapped;return{save:y,update:m,data:w,isPending:a}};export{D as u};
